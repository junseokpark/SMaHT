# Main entrypoint of the workflow. 
# Please follow the best practices: 
# https://snakemake.readthedocs.io/en/stable/snakefiles/best_practices.html,
# in particular regarding the standardized folder structure mentioned there.
#
#

from os.path import join
from snakemake.remote.GS import RemoteProvider as GSRemoteProvider
GS = GSRemoteProvider()
GS_PREFIX = "genomic-instability-data"
SAMPLE_DIR_PREFIX="data_GFP"

### Input File Configuration ###
#SAMPLES, *_ = GS.glob_wildcards(GS_PREFIX + '/'+SAMPLE_DIR_PREFIX+'/{sample}.bam')
#
#GENOME_REF_NAME="hg38_primary_plus_ORFeus_GFP"
#
#
#GENOME_REF=GS.remote(expand(GS_PREFIX + "/ref/" + GENOME_REF_NAME +".{ext}", ext=["fa","fa.fai","dict"]))
#SNV_VCF_NAME="Homo_sapiens_assembly38.dbsnp138"
#INDEL_VCF_NAME="Homo_sapiens_assembly38.known_indels"
#INDEL_VCF2_NAME="Mills_and_1000G_gold_standard.indels.hg38"
#
#### Resource Configuration ###
#MACHINE_TYPE_ALL="n1-standard"
#MACHINE_TYPE_HIGHMEM="n1-highmem"
## MACHINE_TYPE_MULTI="n1-custom-"+MULTI_CORES
## MACHINE_TYPE_SINGE="n1-custom-1"
#
#MULTI_CORES_MAX=8
#MUTLI_CORES_MID=4
#SINGLE_CORES=2 # due to the limitation of memory allocation, selected 2 cores
#
#MEMORY_SIZE_GB_ALL=64
#MEMORY_SIZE_GB_SINGLE_MID=32
#MEMORY_SIZE_GB_SINGLE_LOW=16
#MEMORY_SIZE_MB_DYNAMIC=lambda wildcards, input, attempt: (input.size//1000000) * attempt * 10 # Need to convert to GB
#
#DISK_SIZE_GB_ALL=200000
#DISK_SIZE_GB_MAX=300000
#DISK_SIZE_MB_DYNAMIC=lambda wildcards, input, attempt: max(5*input.size_mb, 1000)
#
#rule all:
#    input:
#            expand(SAMPLE_DIR_PREFIX+"/{sample}.bam", sample=SAMPLES),
#                    expand("flagstat/{sample}.flagstat", sample=SAMPLES),
#                            expand("results/{sample}.markdup.bam", sample=SAMPLES),
#                                    expand("results/{sample}.markdup.sort.bam", sample=SAMPLES),
#                                            expand("results/{sample}.markdup.sort.bam.bai", sample=SAMPLES),
#                                                    expand("results/{sample}.markdup.sort.bqsr_table", sample=SAMPLES),
#                                                            expand("results/{sample}.markdup.sort.bqsr.bam", sample=SAMPLES),
#                                                                    expand("results/{sample}.markdup.sort.bqsr.bam.bai", sample=SAMPLES),
#                                                                            expand("results/{sample}.markdup.sort.bqsr.vcf.gz", sample=SAMPLES),
#                                                                                    expand("results/{sample}.markdup.sort.bqsr.vcf.gz.tbi", sample=SAMPLES),
#                                                                                            expand("results/{sample}.markdup.sort.bqsr.cnn1d.vcf",sample=SAMPLES),
#                                                                                                    expand("results/{sample}.markdup.sort.bqsr.cnn1d.vcf.idx",sample=SAMPLES),
#                                                                                                            expand("results/{sample}.markdup.sort.bqsr.cnn1d.tranche.vcf",sample=SAMPLES),
#                                                                                                                    expand("results/{sample}.markdup.sort.bqsr.cnn1d.tranche.vcf.idx",sample=SAMPLES),
#                                                                                                                            expand("results/{sample}.markdup.samsort.bam",sample=SAMPLES),
#                                                                                                                                    expand("results/{sample}.markdup.samsort.bam.bai",sample=SAMPLES),
#                                                                                                                                            expand("results/{sample}.markdup.samsort.bam.mpileup", sample=SAMPLES),
#                                                                                                                                                    expand("results/{sample}.markdup.samsort.bam.mpileup.varscan.vcf", sample=SAMPLES)
#                                                                                                                                                            # expand("results/{sample}.markdup.samsort.bam.mpileup.varscan.vcf.gz.tbi", sample=SAMPLES)
#
#                                                                                                                                                            rule samtools_flagstat:
#                                                                                                                                                                input:
#                                                                                                                                                                        bam=SAMPLE_DIR_PREFIX+"/{sample}.bam"
#                                                                                                                                                                            output:
#                                                                                                                                                                                    flag="flagstat/{sample}.flagstat"
#                                                                                                                                                                                        resources:
#                                                                                                                                                                                                machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                        _cores=SINGLE_CORES,
#                                                                                                                                                                                                                mem_gb=MEMORY_SIZE_GB_SINGLE_LOW,
#                                                                                                                                                                                                                        disk_mb=DISK_SIZE_GB_ALL
#                                                                                                                                                                                                                            conda:
#                                                                                                                                                                                                                                    "envs/genins.yml"
#                                                                                                                                                                                                                                        # benchmark:
#                                                                                                                                                                                                                                            #     "benchmarks/{sample}.bwa.benchmark.txt"
#                                                                                                                                                                                                                                                message: 
#                                                                                                                                                                                                                                                        """
#                                                                                                                                                                                                                                                                Executing samtools_flagstat rule with \
#                                                                                                                                                                                                                                                                        {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                """
#                                                                                                                                                                                                                                                                                    shell:
#                                                                                                                                                                                                                                                                                           "samtools flagstat {input.bam} > {output.flag}"
#
#                                                                                                                                                                                                                                                                                           # # multi core (less than 4)
#                                                                                                                                                                                                                                                                                           rule picard_markduplicates:
#                                                                                                                                                                                                                                                                                               input:
#                                                                                                                                                                                                                                                                                                       bam=SAMPLE_DIR_PREFIX + "/{sample}.bam"
#                                                                                                                                                                                                                                                                                                           output:
#                                                                                                                                                                                                                                                                                                                   bam="results/{sample}.markdup.bam",
#                                                                                                                                                                                                                                                                                                                           metrics="results/{sample}.markdup_metrics.txt"
#                                                                                                                                                                                                                                                                                                                               resources:
#                                                                                                                                                                                                                                                                                                                                       machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                                                                                                                                                               _cores=MUTLI_CORES_MID,
#                                                                                                                                                                                                                                                                                                                                                       mem_gb=MEMORY_SIZE_GB_SINGLE_MID,
#                                                                                                                                                                                                                                                                                                                                                               disk_mb=DISK_SIZE_GB_ALL
#                                                                                                                                                                                                                                                                                                                                                                   # threads: 
#                                                                                                                                                                                                                                                                                                                                                                       #     4
#                                                                                                                                                                                                                                                                                                                                                                           conda:
#                                                                                                                                                                                                                                                                                                                                                                                   "envs/genins.yml"
#                                                                                                                                                                                                                                                                                                                                                                                       message: 
#                                                                                                                                                                                                                                                                                                                                                                                               """
#                                                                                                                                                                                                                                                                                                                                                                                                       Executing picard_markduplicates rule with \
#                                                                                                                                                                                                                                                                                                                                                                                                               {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                                                                                                                                                       """
#                                                                                                                                                                                                                                                                                                                                                                                                                           log: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                   file="logs/picard_markdup/{sample}.log"
#                                                                                                                                                                                                                                                                                                                                                                                                                                       shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                               """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                       java -XX:+UseParallelGC -XX:ParallelGCThreads={resources._cores} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -Djava.io.tmpdir=/tmp -Xmx{resources.mem_gb}G \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                               -jar /opt/conda/envs/genins/share/picard-3.0.0-0/picard.jar \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           MarkDuplicates I={input.bam} O={output.bam} M={output.metrics} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       VALIDATION_STRINGENCY=LENIENT SORTING_COLLECTION_SIZE_RATIO=0.1 2>&1 | tee {log.file}
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               # # multi core (less than 4)
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               rule picard_sortsam:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   input:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           bam="results/{sample}.markdup.bam"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               output:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       bam="results/{sample}.markdup.sort.bam"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           resources:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           _cores=MUTLI_CORES_MID,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   mem_gb=MEMORY_SIZE_GB_SINGLE_MID,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           disk_mb=DISK_SIZE_GB_ALL
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               conda:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       "envs/genins.yml"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           # threads: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               #     4
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   message: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Executing picard_sortsam rule with \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       log: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               file="logs/picard_sortsam/{sample}.log"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   java -XX:+UseParallelGC -XX:ParallelGCThreads={resources._cores} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               -Djava.io.tmpdir=/tmp -Xmx{resources.mem_gb}G -jar /opt/conda/envs/genins/share/picard-3.0.0-0/picard.jar \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            SortSam I={input.bam} O={output.bam} SORT_ORDER=coordinate 2>&1 | tee {log.file}
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    # # multi core (max)
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    rule index_bam:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        input:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                bam="results/{sample}.markdup.sort.bam"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    output:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            bai="results/{sample}.markdup.sort.bam.bai"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                conda:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "envs/genins.yml"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            resources:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            _cores=MULTI_CORES_MAX,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    mem_gb=MEMORY_SIZE_GB_ALL,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            disk_mb=DISK_SIZE_GB_ALL
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # threads: 8
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    message: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Executing index_bam rule with \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        log:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                file="logs/index_bam/{sample}.log"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "samtools index -@ {resources._cores} {input.bam} 2>&1 | tee {log.file}"
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # multi core (max), disk-size: * cores
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # Not Highmem (normal)
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            rule gatk_bqsr:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                input:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        bam="results/{sample}.markdup.sort.bam",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                bai="results/{sample}.markdup.sort.bam.bai",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        #ref=GS.remote(expand(GS_PREFIX + "/ref/" + GENOME_REF_NAME +".{ext}", ext=["fa","fa.fai","dict"])),
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ref=GENOME_REF,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        snp_vcf=GS.remote(expand(GS_PREFIX + "/ref/broad/" + SNV_VCF_NAME +".{ext}", ext=["vcf","vcf.idx"])),
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                indel_vcf=GS.remote(expand(GS_PREFIX + "/ref/broad/" + INDEL_VCF_NAME +".{ext}", ext=["vcf.gz","vcf.gz.tbi"])),
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        indel_vcf2=GS.remote(expand(GS_PREFIX + "/ref/broad/" + INDEL_VCF2_NAME+".{ext}", ext=["vcf.gz","vcf.gz.tbi"]))        
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            output:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    table="results/{sample}.markdup.sort.bqsr_table"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        conda:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "envs/genins-gatk-broken.yml"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    resources:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    _cores=SINGLE_CORES,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            mem_gb=MEMORY_SIZE_GB_ALL,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    disk_mb=DISK_SIZE_GB_ALL
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        # threads: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #     8
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                message: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Executing gatk_bqsr rule with \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    log:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            file="logs/gatk_bqsr/{sample}.log"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                gatk --java-options "-Xmx{resources.mem_gb}G -Xms{resources.mem_gb}G \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	        -XX:GCTimeLimit=50 -XX:GCHeapFreeLimit=10" BaseRecalibrator \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                    -I {input.bam} -R {input.ref[0]} --known-sites {input.snp_vcf[0]} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                --known-sites {input.indel_vcf[0]} --known-sites {input.indel_vcf2[0]} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                            -O {output.table} 2>&1 | tee {log.file}
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                    """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                            # """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    # gatk --java-options "-Xmx{resources.mem_gb}G -Xms{resources.mem_gb}G \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	    #     -XX:GCTimeLimit=50 -XX:GCHeapFreeLimit=10" BaseRecalibratorSpark \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	            #     --spark-master local[{resources._cores}] -I {input.bam} -R {input.ref[0]} --known-sites {input.snp_vcf[0]} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                    #     --known-sites {input.indel_vcf[0]} --known-sites {input.indel_vcf2[0]} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                            #     -O {output.table} 2>&1 | tee {log.file}
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                    # """
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                    # multi core (max), disk-size: * cores
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                    # Not highmeme (normal)
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                    rule gatk_applybqsr:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                        input:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                bam="results/{sample}.markdup.sort.bam",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                        table="results/{sample}.markdup.sort.bqsr_table",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                #ref=GS.remote(expand(GS_PREFIX + "/ref/" + GENOME_REF_NAME +".{ext}", ext=["fa","fa.fai","dict"]))
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                        ref=GENOME_REF
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                            output:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                    bam="results/{sample}.markdup.sort.bqsr.bam",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                            bai="results/{sample}.markdup.sort.bqsr.bam.bai"      
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                conda:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                        "envs/genins-gatk-broken.yml"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                            resources:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                    machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                            _cores=MULTI_CORES_MAX,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                    mem_gb=MEMORY_SIZE_GB_SINGLE_LOW,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                            disk_mb=DISK_SIZE_GB_ALL
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                # threads: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                    #     8
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                        message: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                        Executing gatk_applybqsr rule with \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                        """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                            log:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                    file="logs/gatk_applybqsr/{sample}.log"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                        shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                         gatk --java-options "-Xmx{resources.mem_gb}G -Xms{resources.mem_gb}G \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                     -XX:GCTimeLimit=50 -XX:GCHeapFreeLimit=10" \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                 ApplyBQSRSpark -R {input.ref[0]} -I {input.bam} --bqsr-recal-file {input.table} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             -O {output.bam} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        --spark-master local[{resources._cores}] \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	        2>&1 | tee {log.file}
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                """
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                # multi core (max), disk-size: * cores
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                rule gatk_haplotypecaller:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                    input:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                            bam="results/{sample}.markdup.sort.bqsr.bam",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                    bai="results/{sample}.markdup.sort.bqsr.bam.bai",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                            #ref=GS.remote(expand(GS_PREFIX + "/ref/" + GENOME_REF_NAME +".{ext}", ext=["fa","fa.fai","dict"])),
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                    ref=GENOME_REF
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                        output:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                vcf="results/{sample}.markdup.sort.bqsr.vcf.gz",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                        idx="results/{sample}.markdup.sort.bqsr.vcf.gz.tbi"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                            conda:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                    "envs/genins-gatk-broken.yml"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                        resources:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                        _cores=MUTLI_CORES_MID,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                mem_gb=MEMORY_SIZE_GB_SINGLE_MID,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                        disk_mb=DISK_SIZE_GB_ALL
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                            threads: MUTLI_CORES_MID*2
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                # threads: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                    #     8
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                        message: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                        Executing gatk_haplotypecaller rule with \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                        """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                            log:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                    file="logs/gatk_haplotypecaller/{sample}.log"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                        shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                        gatk --java-options "-Xmx{resources.mem_gb}G -Xms{resources.mem_gb}G \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                    -XX:GCTimeLimit=50 -XX:GCHeapFreeLimit=10" HaplotypeCaller \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                -R {input.ref[0]} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                            -I {input.bam} -O {output.vcf} -contamination 0.000201 \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                        --native-pair-hmm-threads {threads} 2>&1 | tee {log.file}
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                        # """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                # gatk --java-options "-Xmx{resources.mem_gb}G -Xms{resources.mem_gb}G \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                        #     -XX:GCTimeLimit=50 -XX:GCHeapFreeLimit=10" HaplotypeCallerSpark \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                #     --spark-master local[{resources._cores}] \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                        #     -R {input.ref[0]} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                #     -I {input.bam} -O {output.vcf} -contamination 0.000201 \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                        #     2>&1 | tee {log.file}
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                # """
#
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                # --native-pair-hmm-threads 4
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                # # rule varscan2:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                # #     #/apps/bin/quasimodo_program_varscan2vcf.py
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                # #     shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                # #         """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                # #         docker run  -v /path/to/input/files:/data jeltje/varscan2 -c normal.bam -t tumor.bam -q sampleid -i genome.fa -b centromeres.bed -w targets.bed -s tmpdir > varscan.cnv
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                # #         """
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                # #https://gatk.broadinstitute.org/hc/en-us/articles/360040509151-CNNScoreVariants
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                ## single core only
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                rule cnnfiltervariants:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                    input:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                            vcf="results/{sample}.markdup.sort.bqsr.vcf.gz",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                    idx="results/{sample}.markdup.sort.bqsr.vcf.gz.tbi",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                            ref=GENOME_REF
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                output:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                        vcf="results/{sample}.markdup.sort.bqsr.cnn1d.vcf",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                idx="results/{sample}.markdup.sort.bqsr.cnn1d.vcf.idx"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                    conda:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                            "envs/gatk.yml"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                resources:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                        machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                _cores=SINGLE_CORES,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                        mem_gb=MEMORY_SIZE_GB_SINGLE_LOW,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                disk_mb=DISK_SIZE_GB_ALL
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                    log:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                            file="logs/cnnfiltervariants/{sample}.log"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                message: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                        """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                Executing cnnfiltervariants rule with \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    gatk --java-options "-Xmx{resources.mem_gb}G -Xms{resources.mem_gb}G" CNNScoreVariants   \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -V {input.vcf} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -R {input.ref[0]} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -O {output.vcf} 2>&1 | tee {log.file}
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                """
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # Single Core Only
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # https://gatk.broadinstitute.org/hc/en-us/articles/5358928898971-FilterVariantTranches
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                rule filtervarianttranches1D:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    input:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            vcf="results/{sample}.markdup.sort.bqsr.cnn1d.vcf",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    idx="results/{sample}.markdup.sort.bqsr.cnn1d.vcf.idx",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            snp_vcf=GS.remote(expand(GS_PREFIX + "/ref/broad/" + SNV_VCF_NAME +".{ext}", ext=["vcf","vcf.idx"])),
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    indel_vcf=GS.remote(expand(GS_PREFIX + "/ref/broad/" + INDEL_VCF_NAME +".{ext}", ext=["vcf.gz","vcf.gz.tbi"])),
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            indel_vcf2=GS.remote(expand(GS_PREFIX + "/ref/broad/" + INDEL_VCF2_NAME+".{ext}", ext=["vcf.gz","vcf.gz.tbi"])) 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                output:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        vcf="results/{sample}.markdup.sort.bqsr.cnn1d.tranche.vcf",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                idx="results/{sample}.markdup.sort.bqsr.cnn1d.tranche.vcf.idx"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    conda:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "envs/gatk.yml"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                resources:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                _cores=SINGLE_CORES,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        mem_gb=MEMORY_SIZE_GB_SINGLE_LOW,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                disk_mb=DISK_SIZE_GB_ALL
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    log:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            file = "logs/filtervarianttranches1D/{sample}.log"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	# log:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	    #     file="logs/filtervarianttranches1D/{sample}.log"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	        message: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                        Executing filtervarianttranches1D rule with \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                        """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                            shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                    """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                            gatk --java-options "-Xmx{resources.mem_gb}G -Xms{resources.mem_gb}G" FilterVariantTranches \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                        --resource {input.snp_vcf[0]} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                    -V {input.vcf} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                --resource {input.indel_vcf[0]} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                            --resource {input.indel_vcf2[0]} \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                        --info-key CNN_1D \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                    --snp-tranche 99.95 \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                --indel-tranche 99.4 \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                            -O {output.vcf} 2>&1 | tee {log.file}
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                    """
#
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                    # # https://wiki.bits.vib.be/index.php/Varscan2 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                    rule samtools_sort:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                        input:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                bam="results/{sample}.markdup.bam"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                    output:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                            bam="results/{sample}.markdup.samsort.bam",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                    bai="results/{sample}.markdup.samsort.bam.bai"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                        resources:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                        _cores=SINGLE_CORES,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                mem_gb=MEMORY_SIZE_GB_SINGLE_LOW,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                        disk_mb=DISK_SIZE_GB_ALL
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                            message: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                    """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                            Executing samtools_sort rule with \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                    {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                            """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                # log:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                    #     sort_file="logs/samtools_sort/{sample}.sort.log",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                        #     idx_file="logs/samtools_sort/{sample}.idx.log"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                            shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                    # """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                            # samtools sort {input.bam} -o {output.bam} # 2>&1 | tee {log.sort_file}
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                    # samtools index {output.bam} 2>&1 | tee {log.idx_file}
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                            # """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                    """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                            samtools sort -o {input.bam} {output.bam} > {output.bam}  
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                    samtools index {output.bam} 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                            """
#
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                            rule samtools_mfileup:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                input:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                        bam="results/{sample}.markdup.samsort.bam",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                bai="results/{sample}.markdup.samsort.bam.bai",
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                        ref=GENOME_REF
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                            output:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                    mpileup="results/{sample}.markdup.samsort.bam.mpileup"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                        resources:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                        _cores=SINGLE_CORES,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                mem_gb=MEMORY_SIZE_GB_SINGLE_LOW,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                        disk_mb=DISK_SIZE_GB_ALL
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                            message: 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                    """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                            Executing samtools_mfileup rule with \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                            """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                samtools mpileup -f {input.ref[0]} -d 1000000 \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         {input.bam} > {output.mpileup} 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 """
#
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 rule varscan2:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     input:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             mpileup="results/{sample}.markdup.samsort.bam.mpileup"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 output:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         vcf="results/{sample}.markdup.samsort.bam.mpileup.varscan.vcf"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #tbi="results/{sample}.markdup.samsort.bam.mpileup.varscan.vcf.gz.tbi"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     conda:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             "envs/varscan2.yml" # XXX didn't install varscan2
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 resources:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         machine_type=MACHINE_TYPE_HIGHMEM,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 _cores=SINGLE_CORES,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         mem_gb=MEMORY_SIZE_GB_SINGLE_LOW,
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 disk_mb=DISK_SIZE_GB_MAX
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     # log:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #     file="logs/varscan2/{sample}.log"
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             message:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Executing varscan2 rule with\
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     {resources.machine_type} on the following files {input}.
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 shell:
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 varscan pileup2snp {input.mpileup} --min-avg-qual 20 --p-value 0.01 > {input.mpileup}.varscan.pileup2snp.var 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         varscan pileup2indel {input.mpileup} --min-avg-qual 20 --p-value 0.01 > {input.mpileup}.varscan.pileup2indel.var 
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 python3 /apps/bin/quasimodo_program_varscan2vcf.py -s {input.mpileup}.varscan.pileup2snp.var -i {input.mpileup}.varscan.pileup2indel.var -o {output.vcf}
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         """
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 # bgzip -c {input.mpileup}.varscan.vcf > {output.vcf} && \
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         # tabix -p vcf {output.tbi} 2>&1 | tee {log.file}
#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	                                                                    	                                                                                                                                                                                                                                                             	        	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #  }} 2>&1 | tee {log.file}
